# WAV Recording and Analysis Output

This directory contains the audio recordings and visualizations generated by `demo7_record_wav.cpp` and `analyze_wav.py`.

## üìÅ Files

### Audio Files (WAV)
- **channel1_C4.wav**: Pure C4 sine wave (261.63 Hz)
- **channel2_E4.wav**: Pure E4 sine wave (329.63 Hz)
- **channel3_G4.wav**: Pure G4 sine wave (392.00 Hz)
- **channel4_C5.wav**: Pure C5 sine wave (523.25 Hz)
- **mix_cmajor.wav**: Mixed C major chord (all 4 channels combined)

### Visualization Images (PNG)
- **1_waveforms.png**: Individual waveforms of all 4 channels + mix over full 4-second duration
- **2_beating_zoom.png**: Zoomed view (0.5s) showing beating pattern and amplitude envelope
- **3_spectrograms.png**: Frequency analysis over time for all channels
- **4_envelope_analysis.png**: Envelope extraction and FFT analysis showing beating frequencies

## üéµ Acoustic Beating Analysis

### Expected Beating Frequencies
When two sine waves of different frequencies are combined, they create a **beating effect** with frequency:

$$f_{beat} = |f_1 - f_2|$$

For the C major chord (C4, E4, G4, C5):

| Pair | Frequencies | Difference | Beating |
|------|-------------|------------|---------|
| E4 - C4 | 329.63 - 261.63 Hz | **68.00 Hz** | 68 beats/sec |
| G4 - E4 | 392.00 - 329.63 Hz | **62.37 Hz** | 62 beats/sec |
| G4 - C4 | 392.00 - 261.63 Hz | **130.37 Hz** | 130 beats/sec |
| C5 - G4 | 523.25 - 392.00 Hz | **131.25 Hz** | 131 beats/sec |

### Detected Beating Frequencies (from FFT)
The Python analysis script extracts the amplitude envelope and performs FFT to detect the actual beating frequencies:

- **62.50 Hz**: Strong peak (magnitude 667) - matches **G4-E4** difference
- **4.50-8.50 Hz**: Lower frequency modulation from interference patterns between multiple beating pairs
- **130+ Hz**: Higher frequency beating from octave relationships (G4-C4, C5-G4)

### Auditory Perception
- **< 15 Hz**: Perceived as distinct "beats" or rhythmic tremolo
- **15-60 Hz**: Perceived as rough/harsh texture
- **> 60 Hz**: Perceived as consonance or fused timbre

In this chord:
- The **62-68 Hz** beating creates a slight **vibrato/tremolo** effect
- The **4-8 Hz** modulation creates slower amplitude pulsation
- This is **NATURAL** acoustic phenomenon, NOT a bug!

## üî¨ How to Regenerate

1. **Record audio**:
   ```bash
   ./build/demo7_record_wav
   ```
   This generates the 5 WAV files in `output/`

2. **Analyze and visualize**:
   ```bash
   python3 analyze_wav.py
   ```
   This reads the WAV files and generates the 4 PNG visualization images

3. **View results**:
   ```bash
   open output/*.png
   ```

## üìä Visualization Guide

### 1_waveforms.png
Shows the complete 4-second recording of each individual channel plus the mix. Notice:
- Each channel is a pure sine wave
- The mix shows interference patterns (beating)

### 2_beating_zoom.png
Zoomed 0.5-second window showing:
- **Top plot**: Raw mixed waveform with visible amplitude modulation
- **Bottom plot**: Red envelope overlay showing the beating pattern - amplitude rises and falls periodically

### 3_spectrograms.png
Time-frequency analysis showing:
- Pure single-frequency lines for each channel
- Stable frequency over time (no drift)
- Mix shows multiple frequency components

### 4_envelope_analysis.png
Detailed beating analysis:
- **Top**: Full envelope over 4 seconds
- **Middle**: Detrended envelope (DC removed) showing pure beating modulation
- **Bottom**: FFT of envelope revealing beating frequencies as peaks at 4.5, 5.5, 8.5, and 62.5 Hz

## üéì Musical Context

This beating effect is fundamental to music perception:

- **Tuning**: Instruments are tuned by minimizing beating between reference tones
- **Chorus effect**: Deliberate detuning creates pleasant beating (1-5 Hz)
- **Consonance/dissonance**: Small frequency ratios (like 3/2, 4/3) create slower beating ‚Üí more consonant
- **Vibrato**: Natural vibrato in voice/strings creates similar modulation

For more details, see `docs/BEATING_VIBRATO.md`.

## üõ†Ô∏è Technical Implementation

The recording system uses:

1. **RecorderNode**: Custom node that captures audio to memory buffer
2. **WavWriter**: Simple WAV file writer (PCM 16-bit format)
3. **Offline processing**: No real-time audio I/O - pure computation
4. **GraphManager**: Processes the audio graph block-by-block (512 samples)

Code: `examples/demo7_record_wav.cpp`

Analysis uses:
- **scipy.signal.hilbert**: Analytic signal for envelope extraction
- **scipy.signal.spectrogram**: Time-frequency representation
- **numpy.fft**: Frequency analysis of envelope
- **matplotlib**: Visualization

Code: `analyze_wav.py`
